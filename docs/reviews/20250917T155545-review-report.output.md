<metadata schema_version="1.0">
  <doc_control>
    <doc_id>REVIEW-2025-09-17T144258</doc_id>
    <doc_type>review_report</doc_type>
    <title>Review of Motion Mavericks MVP Portal – Execution Plan (Rev B Spec)</title>
    <version>1.0.0</version>
    <status>complete</status>
    <created>2025-09-17</created>
    <updated>2025-09-17</updated>
    <owner>Gemini AI Assistant</owner>
  </doc_control>
  <governance>
    <jurisdiction>AU</jurisdiction>
    <language>en-AU</language>
    <classification>Confidential</classification>
    <licence>Internal-Use-Only</licence>
  </governance>
  <tags>
    <tag>spec-review</tag><tag>architecture</tag><tag>risk</tag><tag>compliance</tag>
  </tags>
</metadata>

# Recommended Additions and Changes

## Executive summary
The execution plan for the Motion Mavericks MVP Portal is comprehensive and well-structured, leveraging a modern tech stack for rapid development. Key wins include a clear CI/CD strategy, thorough testing plans, and good initial observability. However, the review identifies several critical (P0) risks related to security and reliability that must be addressed before launch. The default assumption of public video playback, optional webhook signature validation, and lack of robust error handling for asynchronous events present significant data leak and system integrity risks. Addressing these P0 items will ensure the MVP is not only functional but also secure and trustworthy from day one.

## Top priorities (P0)
- REC-001 — Mandate Private Video Playback by Default
- REC-002 — Require Webhook Signature Validation
- REC-003 — Implement a Resilient Webhook Ingestion System

## Recommendation table
| ID      | Area                 | Type     | Priority | Rationale                                                              | Proposed change                                                                    | Impact | Effort | Risk | Dependencies |
|---------|----------------------|----------|----------|------------------------------------------------------------------------|------------------------------------------------------------------------------------|--------|--------|------|--------------|
| REC-001 | security_privacy     | Change   | P0       | Defaulting to public video playback creates a critical data privacy risk.  | Mandate use of Mux signed URLs for video playback unless explicitly public.        | H      | M      | H    | Mux SDK      |
| REC-002 | security_privacy     | Change   | P0       | Optional webhook validation allows for trivial spoofing of critical events. | Change "if possible" to "must" for Mux webhook signature validation.               | H      | S      | H    | Mux Docs     |
| REC-003 | reliability          | Addition | P0       | A failed webhook could leave video state inconsistent indefinitely.      | Add a dead-letter queue and automated retry mechanism for webhook ingestion.       | H      | M      | H    | SQS/Vercel KV|
| REC-004 | compliance           | Addition | P1       | The spec omits cookie consent, a likely legal requirement in AU.         | Add a task to implement a cookie consent banner and privacy policy page.           | M      | S      | M    | Legal Review |
| REC-005 | cost                 | Addition | P1       | The lack of a cost model makes financial viability and scaling unclear.  | Add a task to create a cost model and budget based on service pricing tiers.       | M      | M      | M    | -            |
| REC-006 | a11y_i18n            | Addition | P1       | Internationalisation (i18n) is omitted but may be a requirement.         | Clarify i18n requirements and add tasks to set up an i18n framework.             | M      | M      | M    | Stakeholders |
| REC-007 | analytics            | Addition | P1       | Deferring all analytics makes it impossible to measure MVP success.      | Integrate a minimal analytics tool (e.g., PostHog) to track core user actions.     | M      | S      | M    | -            |

## Detailed recommendations

### REC-001 · Mandate Private Video Playback by Default
- **Area:** security_privacy
- **Type:** Change
- **Problem:** The spec states, "For MVP, assume public playback for simplicity," which poses a severe privacy risk if users upload sensitive content.
- **Recommendation:** Change the default behaviour to private. All videos should use Mux's signed URLs (`playback_policy: "signed"`) for playback. Public access should be an explicit choice per video, not the default.
- **Impact:** H
- **Effort:** M
- **Risk:** H
- **Dependencies:** Mux SDK documentation on signed URLs.
- **Acceptance criteria:**
  - All video playback requires a valid, time-limited signed token in the URL.
  - The backend API for retrieving video details is updated to generate and provide these signed URLs.
  - It is not possible to access video content using a direct playback ID without a signature.

### REC-002 · Require Webhook Signature Validation
- **Area:** security_privacy
- **Type:** Change
- **Problem:** The spec says to "verify signature if possible" for Mux webhooks. This is not optional; an unverified endpoint can be exploited by an attacker to forge events and manipulate video statuses in the database.
- **Recommendation:** Mandate webhook signature validation. The implementation must retrieve the Mux signing secret and use it to verify the signature on every incoming webhook request before processing.
- **Impact:** H
- **Effort:** S
- **Risk:** H
- **Dependencies:** Mux documentation for webhook signature validation.
- **Acceptance criteria:**
  - A `MUX_WEBHOOK_SIGNING_SECRET` is added to the environment variables.
  - The `/api/webhooks/mux` endpoint rejects any request that does not have a valid signature in the `Mux-Signature` header.
  - A test is created to simulate a request with an invalid signature and confirm it is rejected with a 403 Forbidden status.

### REC-003 · Implement a Resilient Webhook Ingestion System
- **Area:** reliability
- **Type:** Addition
- **Problem:** The current design has no robust mechanism for handling failures during webhook processing. If the handler fails (e.g., due to a temporary database outage), the event is lost, and the video status remains permanently inconsistent. The planned cron job for cleanup is a weak mitigation, not a solution.
- **Recommendation:** Implement a simple but robust ingestion system. Use a service like Vercel KV or a dedicated queue (e.g., AWS SQS) as a buffer. The webhook endpoint should do nothing but validate the signature and push the event to the queue. A separate, retryable process should consume from the queue to update the database.
- **Impact:** H
- **Effort:** M
- **Risk:** H
- **Dependencies:** Vercel KV or another queuing service.
- **Acceptance criteria:**
  - The Mux webhook handler immediately returns a 200 OK after successfully queuing the event.
  - A separate function/process is responsible for processing events from the queue.
  - If processing fails, the event is automatically retried with an exponential backoff strategy.
  - After a configurable number of retries, the failed event is moved to a dead-letter queue (DLQ) for manual inspection.

### REC-004 · Add Cookie Consent and Privacy Policy
- **Area:** compliance
- **Type:** Addition
- **Problem:** The spec targets the AU jurisdiction but does not include tasks for implementing a cookie consent banner or creating a privacy policy page, which are common legal requirements under privacy laws.
- **Recommendation:** Add tasks to the "Frontend Stage" and "Release Stage" to implement a cookie consent banner and to draft and display a privacy policy.
- **Impact:** M
- **Effort:** S
- **Risk:** M
- **Dependencies:** Legal review to ensure compliance with Australian privacy laws.
- **Acceptance criteria:**
  - A cookie consent banner is displayed to new users.
  - A publicly accessible `/privacy-policy` page is created with the required legal text.

### REC-005 · Develop a Cost Model
- **Area:** cost
- **Type:** Addition
- **Problem:** While the spec mentions monitoring costs, it lacks a concrete cost model or budget. This makes it difficult to predict expenses, plan for scaling, or define fair usage limits for users.
- **Recommendation:** Add a task to the "Preflight Stage" to develop a cost model based on the pricing of Neon, Mux, Vercel, and Resend. The model should estimate costs for different usage scenarios (e.g., 100 users, 1000 users).
- **Impact:** M
- **Effort:** M
- **Risk:** M
- **Dependencies:** -
- **Acceptance criteria:**
  - A spreadsheet or document is created that models costs based on key metrics (e.g., video minutes encoded, GB stored, DB compute hours).
  - The model is used to establish an initial MVP budget and trigger points for re-evaluating service tiers.

### REC-006 · Clarify and Plan for Internationalisation (i18n)
- **Area:** a11y_i18n
- **Type:** Addition
- **Problem:** The spec completely omits internationalisation (i18n). Retrofitting i18n is significantly more difficult than planning for it from the start.
- **Recommendation:** Add a task to the "Product Discovery Stage" to clarify i18n requirements with stakeholders. If required, add tasks to the "Frontend Stage" to implement an i18n framework (e.g., `next-intl`) and extract all user-facing strings into resource files.
- **Impact:** M
- **Effort:** M
- **Risk:** M
- **Dependencies:** Stakeholder decision on i18n scope.
- **Acceptance criteria:**
  - The product owner formally signs off on the i18n requirements (or lack thereof) for the MVP.
  - If required, all UI text is sourced from locale-specific files instead of being hardcoded.

### REC-007 · Integrate Foundational Product Analytics
- **Area:** analytics
- **Type:** Addition
- **Problem:** The spec makes analytics optional, which is a missed opportunity. Without analytics, the team cannot measure user engagement, validate the MVP's success, or make data-driven decisions for the next version.
- **Recommendation:** Integrate a minimal, privacy-focused analytics tool. Add a task to the "Backend Stage" or "Frontend Stage" to implement event tracking for a few key user actions: Sign Up, Video Uploaded, Video Shared.
- **Impact:** M
- **Effort:** S
- **Risk:** M
- **Dependencies:** -
- **Acceptance criteria:**
  - An analytics tool (e.g., PostHog, Plausible) is integrated into the application.
  - Events for `user_signup`, `video_uploaded`, and `video_shared` are tracked, allowing for the creation of a basic conversion funnel.

## Gaps and omissions discovered
- **Private by default:** The spec assumes public video playback, which is a major privacy gap. → covered by REC-001
- **Webhook reliability:** The spec lacks a robust error handling mechanism for webhooks. → covered by REC-003
- **Compliance:** The spec omits cookie consent and a privacy policy. → covered by REC-004
- **Cost model:** No budget or cost model is defined. → covered by REC-005
- **Internationalisation:** i18n is not considered. → covered by REC-006
- **Analytics:** Foundational product analytics are missing. → covered by REC-007
- **Structured Logging:** The spec relies on `console.log` instead of structured logging for better observability.
- **Health Check Endpoint:** No health check endpoint is defined for monitoring service availability.

## Conflicts and ambiguities
- **Webhook security:** The spec is ambiguous ("if possible") about mandatory webhook signature validation. → resolved by REC-002
- **User Profile Data:** The spec is unclear on whether a separate `UserProfile` table is needed or if relying on Clerk data is sufficient. [VERIFY]

## Open questions for the spec owner
1) Is the assumption that a separate `UserProfile` table may not be needed for the MVP correct? Or are there known custom fields required at launch? [VERIFY]
2) Are there any other compliance requirements beyond GDPR/SOC2 (via Clerk) and Australian privacy laws that the team should be aware of? [VERIFY]
3) What is the expected user load for the first 3 months post-launch? This will help refine the cost model and infrastructure choices. [VERIFY]

## Coverage checklist
- Product scope: ✅
- Domain model: ✅
- APIs: ✅
- Security and privacy: ⚠️
- Compliance: ⚠️
- Access control and tenancy: ✅
- Performance and capacity: ✅
- Reliability and SLOs: ⚠️
- Observability: ✅
- CI/CD and environments: ✅
- Testing: ✅
- Migrations and rollout: ✅
- Cost model: ⚠️
- Accessibility and i18n: ⚠️
- Analytics: ⚠️
- Documentation and ops: ✅
