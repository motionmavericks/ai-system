<metadata schema_version="1.0">
  <doc_control>
    <doc_id>REVIEW-2025-09-17T061155</doc_id>
    <doc_type>review_report</doc_type>
    <title>Spec Review: Motion Mavericks MVP Portal</title>
    <version>1.0.0</version>
    <status>final</status>
    <created>2025-09-17</created>
    <updated>2025-09-17</updated>
    <owner>Codex</owner>
  </doc_control>
  <governance>
    <jurisdiction>AU</jurisdiction>
    <language>en-AU</language>
    <classification>Confidential</classification>
    <licence>Internal-Use-Only</licence>
  </governance>
  <tags>
    <tag>spec-review</tag><tag>architecture</tag><tag>risk</tag><tag>compliance</tag>
  </tags>
  <related>
    <source>docs/research/00-high-level-overview.md</source>
    <template>docs/research/02-review-report.template.md</template>
  </related>
</metadata>

# Recommended Additions and Changes

## Review context
- **AI agent:** Codex (GPT-5)
- **Model:** GPT-5 Codex
- **Spec reference:** docs/research/00-high-level-overview.md
- **Review date:** 2025-09-17

## Executive summary
- Share-link playback is configured as public and the upload/webhook mapping assumes asset IDs arrive early, creating critical confidentiality and delivery risks despite otherwise thorough coverage of the build plan.
- Landing the P0 items gives us enforceable access controls, reliable processing updates, and a compliance story that will survive legal review and enterprise procurement.

## Top priorities (P0)
- REC-001 — Enforce signed playback and hardened share-token handling
- REC-002 — Fix Mux upload to webhook correlation design
- REC-003 — Define data residency, retention, and erasure controls

## Recommendation table
| ID      | Area             | Type    | Priority | Rationale                                                                                 | Proposed change                                                                                     | Impact | Effort | Risk | Dependencies         |
|---------|------------------|---------|----------|-------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|--------|--------|------|----------------------|
| REC-001 | security_privacy | Change  | P0       | Spec sets playback_policy to “public”, so anyone with the playback ID can stream content | Use signed playback, bind playback tokens to share records, add expiry/revocation, and audit access  | H      | M      | H    | Mux, Backend, Product |
| REC-002 | apis              | Change  | P0       | Plan assumes Mux direct upload returns asset_id; without upload ID storage webhooks orphan videos | Persist mux_upload_id, reconcile asset IDs on webhook, and add automated recovery for orphan uploads | H      | M      | M    | Backend, Drizzle, Mux  |
| REC-003 | compliance        | Addition| P0       | No documented data residency or deletion policy for AU confidential material               | Produce data flow mapping, retention schedule, and erasure workflow across Neon, Mux, Blob, Clerk     | H      | M      | H    | Legal, Security, Ops  |
| REC-004 | access_control    | Addition| P1       | Creators lack tooling to review or revoke issued share links                              | Build share-token management UI/API with revoke, regenerate, and activity history                    | M      | M      | M    | Backend, Frontend      |
| REC-005 | reliability       | Addition| P1       | No runbook for third-party (Mux/Resend/Neon) outages despite heavy reliance                | Author outage playbooks, escalation paths, and fallback comms for each critical vendor                | M      | S      | M    | Ops, Support          |
| REC-006 | observability     | Addition| P2       | Upload pipeline lacks telemetry to detect stalled assets or failed notifications          | Emit structured events/metrics around upload lifecycle and alert on stuck states                     | M      | S      | M    | Backend, Sentry        |

## Detailed recommendations

### REC-001 · Enforce Signed Playback
- **Area:** security_privacy
- **Type:** Change
- **Problem:** The plan (docs/research/00-high-level-overview.md:144-158) configures Mux uploads with `playback_policy: 'public'`, meaning the Mux playback ID retrieved from a share link remains valid without authentication, undermining confidentiality expectations.
- **Recommendation:** Switch assets to `playback_policy: 'signed'`, generate short-lived signed playback tokens per request server-side, tie playback issuance to an active share record, and record access for audit. Also enforce max token TTL and owner-driven revocation.
- **Impact:** H
- **Effort:** M
- **Risk:** H
- **Dependencies:** Mux configuration, backend share service, product policy
- **Acceptance criteria:**
  - All new uploads default to signed playback policy, and share endpoints deliver signed URLs scoped to the requesting share token with ≤15 minute TTL.
  - Revoked or expired share tokens immediately invalidate further playback attempts (403) and are observable in audit logs with actor, timestamp, and video ID.
- **Notes:** Enables alignment with AU confidential classification and prevents uncontrolled redistribution of playback IDs.

### REC-002 · Correct Upload/Webhook Correlation
- **Area:** apis
- **Type:** Change
- **Problem:** The spec states the direct upload response includes the Mux asset ID to persist, but in practice only the upload ID is returned until processing completes. Without persisting `upload.id`, the webhook can’t be correlated, leaving videos stuck in “processing”.
- **Recommendation:** Persist the Mux upload ID (and optional `external_id`) alongside the provisional video row, update records via webhook using upload ID to retrieve the asset, and schedule a reconciliation job to query Mux for uploads that never emitted a ready event.
- **Impact:** H
- **Effort:** M
- **Risk:** M
- **Dependencies:** Backend integration, Drizzle schema updates, Mux SDK usage
- **Acceptance criteria:**
  - Database schema includes `mux_upload_id` with uniqueness per video, and automated tests prove webhook updates the correct row using that key.
  - A reconciliation script/job identifies uploads older than threshold without assets, checks Mux API, and either updates or flags them for manual action.
- **Notes:** Aligns implementation with Mux API contract and prevents orphaned content.

### REC-003 · Data Residency & Lifecycle Controls
- **Area:** compliance
- **Type:** Addition
- **Problem:** The execution plan defers compliance to vendor assurances (“not a major focus”), leaving no documented data flow, residency guarantees, or deletion paths for sensitive creator content held in offshore services.
- **Recommendation:** Produce a compliance package covering data locations, retention, deletion, and subject-request handling across Neon, Mux, Vercel Blob, and Clerk; ensure contractual commitments and technical hooks exist to execute the policy.
- **Impact:** H
- **Effort:** M
- **Risk:** H
- **Dependencies:** Legal counsel, vendor agreements, backend workflow
- **Acceptance criteria:**
  - Approved data flow diagram listing jurisdictions and subprocessors with mitigation plan for non-AU storage.
  - Documented retention schedule plus automated erasure routines (including Mux asset deletion and Neon row purge) for user-initiated and time-based deletion.
  - Service-level test demonstrating full account/data erasure propagates within agreed timeframe and captures evidence for audit.
- **Notes:** Required to satisfy Australian Privacy Act, enterprise customer reviews, and internal confidentiality classification.

### REC-004 · Share Token Governance
- **Area:** access_control
- **Type:** Addition
- **Problem:** Creators have no interface to view issued share links, monitor usage, or revoke access after distribution, limiting control and violating least-privilege expectations.
- **Recommendation:** Provide management UI/API listing active tokens, last access time, recipient metadata, with actions to revoke, regenerate, or extend expiry, and surface this in creator settings.
- **Impact:** M
- **Effort:** M
- **Risk:** M
- **Dependencies:** Backend share service, frontend dashboard, auditing store
- **Acceptance criteria:**
  - Creators can list all share tokens for a video with creation, expiry, and last-view timestamps.
  - Revocation and regeneration actions propagate immediately to playback enforcement and emit audit events stored for ≥90 days.
- **Notes:** Builds on REC-001 controls and supports customer support inquiries.

### REC-005 · Third-party Outage Playbooks
- **Area:** reliability
- **Type:** Addition
- **Problem:** Heavy reliance on Mux, Resend, Neon, and Vercel lacks documented contingency plans, leaving the team unprepared for vendor outages that halt uploads or notifications.
- **Recommendation:** Draft and circulate runbooks covering detection, mitigation, communication, and fallback procedures (e.g., queue uploads locally, switch to backup email provider) for each critical dependency.
- **Impact:** M
- **Effort:** S
- **Risk:** M
- **Dependencies:** Ops team, vendor status integrations, support processes
- **Acceptance criteria:**
  - Runbooks stored in shared repo detail triggers, escalation contacts, fallback steps, and customer comms templates for each vendor.
  - Quarterly tabletop exercise validates runbooks and captures updates; post-mortem template references them.
- **Notes:** Supports REC-003 compliance commitments around incident response.

### REC-006 · Upload Telemetry & Alerts
- **Area:** observability
- **Type:** Addition
- **Problem:** No metrics or alerts exist for upload progress, webhook success, or notification failures, delaying detection of stalled videos and undermining UX promises.
- **Recommendation:** Instrument structured logs/metrics (e.g., Sentry spans, custom dashboards) around upload initiation, webhook receipt, notification send, and share plays; add alerts for anomalies (e.g., uploads stuck >15 minutes, webhook failure rate >5%).
- **Impact:** M
- **Effort:** S
- **Risk:** M
- **Dependencies:** Backend instrumentation, Sentry/analytics config, Ops
- **Acceptance criteria:**
  - Dashboard visualises upload lifecycle counts and durations with alerting rules for SLA breaches.
  - Alert runbook links ensure responders can drill into correlated logs within minutes of threshold breach.
- **Notes:** Complements REC-002 reconciliation and REC-005 incident handling.

## Gaps and omissions discovered
- Lack of signed playback and revocation controls for shared videos → covered by REC-001
- Missing persistence of Mux upload identifiers leading to stuck processing states → covered by REC-002
- No residency or deletion policy for sensitive creator data across vendors → covered by REC-003

## Conflicts and ambiguities
- Direct upload step claims to receive and store Mux asset IDs immediately, which contradicts Mux API behaviour → resolved by REC-002
- Security section assumes public playback aligns with confidential classification without justification → resolved by REC-001

## Open questions for the spec owner
1) Do enterprise customers require AU-only storage or is offshore hosting acceptable with contractual safeguards? [VERIFY]
2) What retention window satisfies both creator expectations and legal obligations for stored videos and share tokens? [VERIFY]

## Coverage checklist
- Product scope: ✅
- Domain model: ✅ (REC-002)
- APIs: ✅ (REC-002)
- Security and privacy: ✅ (REC-001, REC-004)
- Compliance: ✅ (REC-003)
- Access control and tenancy: ✅ (REC-001, REC-004)
- Performance and capacity: ✅
- Reliability: ✅ (REC-005)
- Observability: ✅ (REC-006)
- CI/CD and environments: ✅
- Testing: ✅
- Migrations and rollout: ✅
- Cost model: ✅
- Accessibility and i18n: ✅
- Analytics: ✅
- Documentation and ops: ✅ (REC-005)
