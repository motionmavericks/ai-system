meta:
  name: "Motion Mavericks Portal MVP"
  repo: "https://github.com/maverick/ai-system"
  version: "0.1.0"
  language: "en-AU"
  environments:
    - dev
    - staging
    - prod
  contacts:
    product: "Owen (Founder)"
    reliability: "Reliability Partner"
    client_success: "Client Success Lead"
scope:
  personas:
    admin:
      description: "Motion Mavericks internal coordinators with full control over tenants and projects."
    agency:
      description: "Partner producers managing milestones, tasks, assets, and notifications."
    guest:
      description: "Client reviewers accessing read-only share links and providing feedback."
  epics:
    onboarding:
      description: "Invite and activate Admin/Agency/Guest users, enforce tenancy, surface welcome tasks."
      acceptance:
        - "Admin can invite agency users; invite flow verified via magic link"
        - "Agency user first login exposes onboarding checklist"
        - "Guest share link creation triggers invitation email"
    project_management:
      description: "Create projects, milestones, tasks with status tracking and ownership."
      acceptance:
        - "Admin creates project with required metadata (client, due dates, timezone)"
        - "Agency updates milestone status; audit log entry recorded"
        - "Task board supports assignments, due dates, comments"
    asset_delivery:
      description: "Upload media assets via Mux, manage metadata, surface preview playback."
      acceptance:
        - "Agency uploads asset (<=20GB dev, production via Mux direct upload)"
        - "Mux webhook updates asset status; Admin notified"
        - "Share link playback respects expiry and audit logging"
    collaboration:
      description: "Inline comments, notifications, digests, and feedback workflows."
      acceptance:
        - "Agency/Admin comment on milestones/tasks; mentions trigger notifications"
        - "Guests submit feedback via share link; visible to authorised users"
        - "Notification digest emails respect frequency preferences"
    compliance_security:
      description: "Privacy, residency, audit, secrets, and incident coverage."
      acceptance:
        - "Audit log captures share link access, status edits, asset views"
        - "Secrets stored in Vercel env + 1Password; rotation tasks logged"
        - "Incident response playbook accessible in docs"
non_functional_requirements:
  availability: "99.9% monthly"
  api_latency_p95_ms: 300
  share_validation_latency_ms: 150
  video_ttfp_p95_seconds: 3
  accessibility: "WCAG 2.2 AA"
  residency: "Primary data in Neon syd1; backups remain AU-first"
  rpo_hours: 24
  rto_hours: 1
architecture:
  frontend:
    framework: "Next.js 15 (App Router)"
    language: "TypeScript"
    state: "React Server Components + client providers"
    routing:
      - path: "/dashboard"
        description: "Tenant-aware project overview"
      - path: "/projects/[projectId]"
        description: "Milestone/task detail"
      - path: "/share/[token]"
        description: "Guest view"
  backend:
    runtime: "Vercel serverless functions"
    api_style: "REST with Next.js route handlers"
    background_jobs:
      - "Share link expiry sweeps"
      - "Notification digests"
      - "Mux webhook processing"
  data:
    primary_db: "Neon Postgres"
    orm: "Drizzle"
    cache: "Upstash Redis"
    storage: "Mux asset storage"
    entities:
      - tenants
      - users
      - projects
      - milestones
      - tasks
      - assets
      - share_links
      - comments
      - notifications
      - audit_events
  integrations:
    auth: "Clerk"
    email: "Resend"
    media: "Mux"
    observability: ["Sentry", "Grafana", "Tempo", "Logtail"]
  deployment:
    platform: "Vercel"
    environments:
      dev: "Preview deployments"
      staging: "Main branch promotion"
      prod: "Manual promotion post checklist"
ci_cd:
  tool: "GitHub Actions"
  stages:
    - lint
    - typecheck
    - unit_tests
    - integration_tests
    - e2e_smoke
    - accessibility
    - performance_smoke
    - security_scan
  required_checks:
    - lint
    - typecheck
    - unit_tests
    - integration_tests
    - e2e_smoke
  artefacts:
    - "Playwright traces"
    - "k6 metrics"
    - "Coverage reports"
data_migrations:
  process:
    - "Define schema via Drizzle models"
    - "Generate migration SQL"
    - "Apply migrations via CI to staging before prod"
    - "Rollback path or compensating scripts required"
  seed_data:
    - "Base tenant (Motion Mavericks)"
    - "Pilot agencies"
    - "Sample projects, milestones, tasks"
    - "Demo assets"
    - "Notification templates"
security_controls:
  auth:
    - "Magic link login with Clerk"
    - "Role-based guard (admin/agency/guest)"
  share_links:
    - "Signed token with expiry"
    - "Optional passphrase"
    - "Audit logging on access"
  secrets:
    storage:
      - "Vercel env vars"
      - "1Password vault"
    rotation_schedule_days:
      clerk: 180
      mux: 120
      resend: 90
      neon_passwords: 90
  incident_response:
    severity_matrix: ["SEV0", "SEV1", "SEV2", "SEV3"]
    response_target_minutes:
      sev0: 15
      sev1: 30
      sev2: 120
      sev3: 1440
observability:
  logging: "Structured JSON via Pino -> Logtail -> Grafana Loki"
  metrics: "SLO dashboards in Grafana (availability, latency, share success, playback, notifications, backups)"
  tracing: "OpenTelemetry -> Grafana Tempo (20% sample, 100% errors)"
  alerting:
    - metric: "API availability"
      threshold: "<99.7% over 15 minutes"
      destination: "PagerDuty P1"
    - metric: "Share link success"
      threshold: "<98% over 10 minutes"
      destination: "PagerDuty + #share-alerts"
    - metric: "Backup failure"
      threshold: "Any failure"
      destination: "PagerDuty"
memory:
  vector_store:
    provider: "Mem0 (pgvector)"
    endpoint_env: "MEMORY_VECTOR_URL"
    token_env: "MEMORY_VECTOR_API_KEY"
    retention_days: 180
  graph_store:
    provider: "Neo4j Aura"
    endpoint_env: "MEMORY_GRAPH_URL"
    user_env: "MEMORY_GRAPH_USER"
    password_env: "MEMORY_GRAPH_PASSWORD"
  cache:
    provider: "Upstash Redis"
    endpoint_env: "MEMORY_REDIS_URL"
    token_env: "MEMORY_REDIS_TOKEN"
    ttl_days:
      telemetry: 30
      replay: 90
  local_mirror:
    path: "automations/memory"
    validation_script: "automations/scripts/memory-validate.mjs"
    compaction_script: "automations/scripts/memory-compact.mjs"
qa_plan:
  unit_tests:
    framework: "Vitest"
    coverage_target: 0.8
    focus_modules:
      - "Milestone status calculations"
      - "Share token helpers"
      - "Notification payload builders"
  integration_tests:
    framework: "Vitest + Supertest"
    components:
      - "/api/projects"
      - "Mux webhook consumer"
      - "Notification queue"
  e2e_tests:
    framework: "Playwright"
    flows:
      - "Invite -> login -> dashboard"
      - "Milestone update -> notification"
      - "Share link creation -> guest playback"
      - "Notification digest preference update"
  performance_tests:
    tool: "k6"
    scenarios:
      - "Project dashboard 200 concurrent"
      - "Share link 500 concurrent"
  accessibility_tests:
    tool: "axe-playwright"
    pages:
      - "Dashboard"
      - "Project detail"
      - "Share link view"
release_management:
  cadence:
    standard: "Tue/Thu 10:00 AEST"
    hotfix: "As needed with approvals"
  promotion: "Preview -> Staging -> Production"
  go_no_go:
    signoffs: ["Technical Lead", "Reliability Partner", "Client Success Lead", "Legal Counsel", "Marketing Lead", "Founder"]
  rollback:
    command: "vercel rollback <deployment-id>"
    db_strategy: "Drizzle rollback or compensating migration"
  change_log: "docs/playbook/20-03-change-log.md"
automation_requirements:
  inputs:
    - "automations/build-spec.yaml"
    - "docs/playbook/"
    - "automations/docs/agent-orchestration.md"
    - "automations/docs/guardrails.md"
  outputs:
    code_repos:
      - path: "apps/web"
        description: "Next.js 15 portal"
      - path: "packages/api"
        description: "Shared API logic"
      - path: "packages/db"
        description: "Drizzle schema & migrations"
    pipelines:
      - ".github/workflows/ci.yml"
    documentation_updates:
      - "docs/playbook/20-03-change-log.md"
